<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Gomoku Game</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f2f2f2;
      text-align: center;
      margin: 0;
    }
    h1 {
      margin-top: 10px;
    }
    #menu {
      margin: 10px;
    }
    #board-container {
      display: flex;
      justify-content: center;
      margin: 10px;
    }
    #board {
      display: grid;
      background-color: #dcb87b;
      border: 4px solid #444;
    }
    .cell {
      width: 30px;
      height: 30px;
      box-sizing: border-box;
      position: relative;
      border-top: 1px solid #8b5a2b;
      border-left: 1px solid #8b5a2b;
    }
    .black, .white {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      position: absolute;
      top: 3px;
      left: 3px;
    }
    .black {
      background: black;
    }
    .white {
      background: white;
      border: 1px solid #aaa;
    }
    select, button {
      padding: 8px 14px;
      margin: 5px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      background-color: #007acc;
      color: white;
      cursor: pointer;
    }
    #status {
      font-weight: bold;
      margin: 10px;
    }
  </style>
</head>
<body>

<h1>ğŸ¯ Gomoku Game</h1>

<div id="menu">
  <label>ãƒ¢ãƒ¼ãƒ‰:
    <select id="mode">
      <option value="ai">AIå¯¾æˆ¦</option>
      <option value="2p">2äººå¯¾æˆ¦</option>
    </select>
  </label>
  <label>é›£æ˜“åº¦:
    <select id="difficulty">
      <option value="easy">ç°¡å˜</option>
      <option value="hard" selected>é›£ã—ã„</option>
    </select>
  </label>
  <label>ç›¤é¢ã‚µã‚¤ã‚º:
    <select id="boardsize">
      <option value="15" selected>15Ã—15ï¼ˆäº”å­æ£‹ï¼‰</option>
      <option value="19">19Ã—19ï¼ˆå…­å­æ£‹ï¼‰</option>
    </select>
  </label>
  <button onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
</div>

<div id="status">è¨­å®šã‚’é¸ã‚“ã§é–‹å§‹ã—ã¦ãã ã•ã„ã€‚</div>
<div id="board-container"><div id="board"></div></div>

<script>
  let size = 15;
  let board = [];
  let isOver = false;
  let turn = 1;
  let mode = 'ai';
  let difficulty = 'hard';

  const directions = [[1,0],[0,1],[1,1],[1,-1]];
  const boardEl = document.getElementById('board');
  const statusEl = document.getElementById('status');

  function startGame() {
    size = parseInt(document.getElementById('boardsize').value);
    mode = document.getElementById('mode').value;
    difficulty = document.getElementById('difficulty').value;
    boardEl.style.gridTemplateColumns = `repeat(${size}, 30px)`;
    boardEl.style.gridTemplateRows = `repeat(${size}, 30px)`;
    board = [];
    boardEl.innerHTML = '';
    isOver = false;
    turn = 1;
    statusEl.textContent = mode === '2p' ? 'é»’ã®ç•ªã§ã™' : 'ã‚ãªãŸã¯é»’ã§ã™ã€‚å…ˆã«æ‰“ã£ã¦ãã ã•ã„ã€‚';

    for (let i = 0; i < size; i++) {
      board[i] = [];
      for (let j = 0; j < size; j++) {
        board[i][j] = 0;
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.row = i;
        cell.dataset.col = j;

        // âœ… è¾¹ç¼˜æ ¼å­å¢åŠ å³è¾¹æ¡†å’Œä¸‹è¾¹æ¡†
        if (j === size - 1) cell.style.borderRight = '1px solid #8b5a2b';
        if (i === size - 1) cell.style.borderBottom = '1px solid #8b5a2b';

        cell.addEventListener('click', onMove);
        boardEl.appendChild(cell);
      }
    }
  }

  function onMove(e) {
    if (isOver) return;
    const r = +e.target.dataset.row;
    const c = +e.target.dataset.col;
    if (board[r][c] !== 0) return;

    if (mode === '2p') {
      placeStone(r, c, turn);
      if (checkWin(r, c, turn)) {
        statusEl.textContent = (turn === 1 ? 'é»’' : 'ç™½') + 'ã®å‹ã¡ï¼ğŸ‰';
        isOver = true;
      } else {
        turn = 3 - turn;
        statusEl.textContent = (turn === 1 ? 'é»’' : 'ç™½') + 'ã®ç•ªã§ã™';
      }
    } else {
      placeStone(r, c, 1);
      if (checkWin(r, c, 1)) {
        statusEl.textContent = 'ğŸ‰ å‹åˆ©ï¼ã‚ãªãŸã®å‹ã¡ï¼';
        isOver = true;
        return;
      }
      setTimeout(aiMove, 300);
    }
  }

  function aiMove() {
    if (isOver) return;
    const [r, c] = difficulty === 'easy' ? randomMove() : findBestMove();
    placeStone(r, c, 2);
    if (checkWin(r, c, 2)) {
      statusEl.textContent = 'ğŸ˜¢ AIã®å‹ã¡ã€‚';
      isOver = true;
    }
  }

  function placeStone(r, c, type) {
    board[r][c] = type;
    const cell = document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
    const stone = document.createElement('div');
    stone.className = type === 1 ? 'black' : 'white';
    cell.appendChild(stone);
  }

  function checkWin(r, c, type) {
    for (const [dx, dy] of directions) {
      let count = 1;
      for (let i = 1; i < 6; i++) {
        const nr = r + dx*i, nc = c + dy*i;
        if (nr < 0 || nc < 0 || nr >= size || nc >= size) break;
        if (board[nr][nc] === type) count++; else break;
      }
      for (let i = 1; i < 6; i++) {
        const nr = r - dx*i, nc = c - dy*i;
        if (nr < 0 || nc < 0 || nr >= size || nc >= size) break;
        if (board[nr][nc] === type) count++; else break;
      }
      if (count >= 5) return true;
    }
    return false;
  }

  function randomMove() {
    const empty = [];
    for (let i = 0; i < size; i++)
      for (let j = 0; j < size; j++)
        if (board[i][j] === 0) empty.push([i,j]);
    return empty[Math.floor(Math.random() * empty.length)];
  }

  function scoreLine(cnt, open) {
    if (cnt >= 5) return 99999;
    if (cnt === 4 && open === 2) return 10000;
    if (cnt === 4 && open === 1) return 1000;
    if (cnt === 3 && open === 2) return 300;
    if (cnt === 3 && open === 1) return 50;
    if (cnt === 2 && open === 2) return 20;
    return 1;
  }

  function evaluate(r, c, t) {
    let score = 0;
    for (const [dx, dy] of directions) {
      let cnt = 1, open = 0;
      for (let i = 1; i < 5; i++) {
        const nr = r + dx*i, nc = c + dy*i;
        if (nr < 0 || nc < 0 || nr >= size || nc >= size) break;
        if (board[nr][nc] === t) cnt++;
        else if (board[nr][nc] === 0) { open++; break; } else break;
      }
      for (let i = 1; i < 5; i++) {
        const nr = r - dx*i, nc = c - dy*i;
        if (nr < 0 || nc < 0 || nr >= size || nc >= size) break;
        if (board[nr][nc] === t) cnt++;
        else if (board[nr][nc] === 0) { open++; break; } else break;
      }
      score += scoreLine(cnt, open);
    }
    return score;
  }

  function findBestMove() {
    let max = -1, best = [Math.floor(size/2), Math.floor(size/2)];
    for (let i = 0; i < size; i++) {
      for (let j = 0; j < size; j++) {
        if (board[i][j] !== 0) continue;
        const score = evaluate(i,j,2) + 0.8*evaluate(i,j,1);
        if (score > max) {
          max = score;
          best = [i,j];
        }
      }
    }
    return best;
  }

</script>

</body>
</html>